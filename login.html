<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>BookStore - ƒêƒÉng nh·∫≠p</title>
        <link rel="stylesheet" href="css/login.css" />
    </head>
    <body>
        <div class="auth-wrapper">
            <!-- Left Side - Brand -->
            <div class="auth-brand">
                <div class="brand-content">
                    <div class="brand-logo">üìö</div>
                    <h2>BookStore</h2>
                    <p>Th∆∞ vi·ªán s√°ch tr·ª±c tuy·∫øn h√†ng ƒë·∫ßu Vi·ªát Nam</p>
                    <ul class="brand-features">
                        <li>H√†ng ng√†n ƒë·∫ßu s√°ch ƒëa d·∫°ng</li>
                        <li>Giao h√†ng nhanh ch√≥ng to√†n qu·ªëc</li>
                        <li>Gi√° c·∫£ c·∫°nh tranh nh·∫•t th·ªã tr∆∞·ªùng</li>
                        <li>H·ªó tr·ª£ kh√°ch h√†ng 24/7</li>
                    </ul>
                </div>
            </div>

            <!-- Right Side - Forms -->
            <div class="auth-forms">
                <a href="home.html" class="back-home">‚Üê V·ªÅ trang ch·ªß</a>

                <!-- Login Form -->
                <div id="login-form" class="form-container active">
                    <div class="form-header">
                        <h3>ƒêƒÉng nh·∫≠p</h3>
                        <p>Ch√†o m·ª´ng b·∫°n quay tr·ªü l·∫°i!</p>
                    </div>

                    <div id="login-alert" class="alert"></div>

                    <form id="loginForm">
                        <div class="form-group">
                            <label>Email <span class="required">*</span></label>
                            <div class="input-wrapper">
                                <span class="icon">üìß</span>
                                <input
                                    type="email"
                                    id="login-email"
                                    class="form-control"
                                    placeholder="example@email.com"
                                    required
                                />
                            </div>
                            <div
                                class="error-message"
                                id="login-email-error"
                            ></div>
                        </div>

                        <div class="form-group">
                            <label
                                >M·∫≠t kh·∫©u <span class="required">*</span></label
                            >
                            <div class="input-wrapper">
                                <span class="icon">üîí</span>
                                <input
                                    type="password"
                                    id="login-password"
                                    class="form-control"
                                    placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                                    required
                                />
                                <button
                                    type="button"
                                    class="password-toggle"
                                    onclick="togglePassword('login-password')"
                                >
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <div
                                class="error-message"
                                id="login-password-error"
                            ></div>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="remember-me" />
                            <label for="remember-me">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            ƒêƒÉng nh·∫≠p
                        </button>
                    </form>

                    <div class="form-toggle">
                        Ch∆∞a c√≥ t√†i kho·∫£n?
                        <a onclick="switchForm('register')">ƒêƒÉng k√Ω ngay</a>
                    </div>
                </div>

                <!-- Register Form -->
                <div id="register-form" class="form-container">
                    <div class="form-header">
                        <h3>ƒêƒÉng k√Ω</h3>
                        <p>T·∫°o t√†i kho·∫£n m·ªõi ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                    </div>

                    <div id="register-alert" class="alert"></div>

                    <form id="registerForm">
                        <div class="form-group">
                            <label
                                >H·ªç v√† t√™n
                                <span class="required">*</span></label
                            >
                            <div class="input-wrapper">
                                <span class="icon">üë§</span>
                                <input
                                    type="text"
                                    id="register-name"
                                    class="form-control"
                                    placeholder="Nguy·ªÖn VƒÉn A"
                                    required
                                />
                            </div>
                            <div
                                class="error-message"
                                id="register-name-error"
                            ></div>
                        </div>

                        <div class="form-group">
                            <label>Email <span class="required">*</span></label>
                            <div class="input-wrapper">
                                <span class="icon">üìß</span>
                                <input
                                    type="email"
                                    id="register-email"
                                    class="form-control"
                                    placeholder="example@email.com"
                                    required
                                />
                            </div>
                            <div
                                class="error-message"
                                id="register-email-error"
                            ></div>
                        </div>

                        <div class="form-group">
                            <label
                                >M·∫≠t kh·∫©u <span class="required">*</span></label
                            >
                            <div class="input-wrapper">
                                <span class="icon">üîí</span>
                                <input
                                    type="password"
                                    id="register-password"
                                    class="form-control"
                                    placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±"
                                    required
                                    minlength="6"
                                />
                                <button
                                    type="button"
                                    class="password-toggle"
                                    onclick="togglePassword('register-password')"
                                >
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <div
                                class="password-strength"
                                id="password-strength"
                            >
                                <div class="password-strength-bar"></div>
                            </div>
                            <div
                                class="password-strength-text"
                                id="password-strength-text"
                            ></div>
                            <div
                                class="error-message"
                                id="register-password-error"
                            ></div>
                        </div>

                        <div class="form-group">
                            <label
                                >X√°c nh·∫≠n m·∫≠t kh·∫©u
                                <span class="required">*</span></label
                            >
                            <div class="input-wrapper">
                                <span class="icon">üîí</span>
                                <input
                                    type="password"
                                    id="register-confirm-password"
                                    class="form-control"
                                    placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u"
                                    required
                                />
                                <button
                                    type="button"
                                    class="password-toggle"
                                    onclick="togglePassword('register-confirm-password')"
                                >
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <div
                                class="error-message"
                                id="register-confirm-error"
                            ></div>
                        </div>

                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="agree-terms" required />
                            <label for="agree-terms"
                                >T√¥i ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n d·ªãch v·ª•</label
                            >
                        </div>

                        <button type="submit" class="btn btn-primary">
                            ƒêƒÉng k√Ω
                        </button>
                    </form>

                    <div class="form-toggle">
                        ƒê√£ c√≥ t√†i kho·∫£n?
                        <a onclick="switchForm('login')">ƒêƒÉng nh·∫≠p</a>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Toggle password visibility
            function togglePassword(inputId) {
                const input = document.getElementById(inputId)
                const type =
                    input.getAttribute('type') === 'password'
                        ? 'text'
                        : 'password'
                input.setAttribute('type', type)
            }

            // Switch between login and register forms
            function switchForm(formType) {
                document.getElementById('login-form').classList.remove('active')
                document
                    .getElementById('register-form')
                    .classList.remove('active')

                if (formType === 'login') {
                    document
                        .getElementById('login-form')
                        .classList.add('active')
                } else {
                    document
                        .getElementById('register-form')
                        .classList.add('active')
                }

                // Clear alerts
                hideAlert('login-alert')
                hideAlert('register-alert')
            }

            // Show alert message
            function showAlert(elementId, message, type) {
                const alert = document.getElementById(elementId)
                alert.textContent = message
                alert.className = `alert ${type} show`

                setTimeout(() => {
                    hideAlert(elementId)
                }, 5000)
            }

            // Hide alert message
            function hideAlert(elementId) {
                const alert = document.getElementById(elementId)
                alert.classList.remove('show')
            }

            // Show error message
            function showError(elementId, message) {
                const errorElement = document.getElementById(elementId)
                errorElement.textContent = message
                errorElement.classList.add('show')
            }

            // Hide error message
            function hideError(elementId) {
                const errorElement = document.getElementById(elementId)
                errorElement.classList.remove('show')
            }

            // Validate email
            function isValidEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
                return re.test(email)
            }

            // Password strength checker
            function checkPasswordStrength(password) {
                let strength = 0
                if (password.length >= 6) strength++
                if (password.length >= 10) strength++
                if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++
                if (/\d/.test(password)) strength++
                if (/[^a-zA-Z\d]/.test(password)) strength++
                return strength
            }

            // Update password strength indicator
            document
                .getElementById('register-password')
                ?.addEventListener('input', function () {
                    const password = this.value
                    const strengthBar = document.querySelector(
                        '.password-strength-bar'
                    )
                    const strengthText = document.getElementById(
                        'password-strength-text'
                    )
                    const strengthContainer =
                        document.getElementById('password-strength')

                    if (password.length === 0) {
                        strengthContainer.classList.remove('show')
                        strengthText.classList.remove('show')
                        return
                    }

                    strengthContainer.classList.add('show')
                    strengthText.classList.add('show')

                    const strength = checkPasswordStrength(password)

                    if (strength <= 2) {
                        strengthBar.style.width = '33%'
                        strengthBar.style.background = '#ff6b6b'
                        strengthText.textContent = 'M·∫≠t kh·∫©u y·∫øu'
                        strengthText.style.color = '#ff6b6b'
                    } else if (strength <= 3) {
                        strengthBar.style.width = '66%'
                        strengthBar.style.background = '#ffd93d'
                        strengthText.textContent = 'M·∫≠t kh·∫©u trung b√¨nh'
                        strengthText.style.color = '#ffd93d'
                    } else {
                        strengthBar.style.width = '100%'
                        strengthBar.style.background = '#51cf66'
                        strengthText.textContent = 'M·∫≠t kh·∫©u m·∫°nh'
                        strengthText.style.color = '#51cf66'
                    }
                })

            // LOGIN FORM HANDLER
            document
                .getElementById('loginForm')
                .addEventListener('submit', function (e) {
                    e.preventDefault()

                    const email = document
                        .getElementById('login-email')
                        .value.trim()
                    const password =
                        document.getElementById('login-password').value
                    const rememberMe =
                        document.getElementById('remember-me').checked

                    // Clear previous errors
                    hideError('login-email-error')
                    hideError('login-password-error')

                    // Validation
                    let hasError = false

                    if (!isValidEmail(email)) {
                        showError('login-email-error', 'Email kh√¥ng h·ª£p l·ªá')
                        hasError = true
                    }

                    if (password.length < 6) {
                        showError(
                            'login-password-error',
                            'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±'
                        )
                        hasError = true
                    }

                    if (hasError) return

                    // Get users from localStorage
                    const users = JSON.parse(
                        localStorage.getItem('bs_users') || '[]'
                    )

                    // Find user
                    const user = users.find(
                        (u) => u.email === email && u.password === password
                    )

                    if (user) {
                        // Ki·ªÉm tra t√†i kho·∫£n b·ªã kh√≥a (x·ª≠ l√Ω c·∫£ boolean v√† string)
                        const isLocked = user.locked === true || user.locked === 'true'
                        if (isLocked) {
                            showAlert(
                                'login-alert',
                                'üîí T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ b·ªã kh√≥a. Vui l√≤ng li√™n h·ªá Admin.',
                                'alert-error'
                            )
                            return
                        }

                        // Save auth info
                        const authData = {
                            email: user.email,
                            name: user.name,
                            loginTime: new Date().toISOString(),
                        }

                        if (rememberMe) {
                            localStorage.setItem(
                                'bs_auth',
                                JSON.stringify(authData)
                            )
                        } else {
                            sessionStorage.setItem(
                                'bs_auth',
                                JSON.stringify(authData)
                            )
                        }

                        showAlert(
                            'login-alert',
                            'ƒêƒÉng nh·∫≠p th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...',
                            'alert-success'
                        )

                        setTimeout(() => {
                            window.location.href = 'home.html'
                        }, 1500)
                    } else {
                        showAlert(
                            'login-alert',
                            'Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ch√≠nh x√°c!',
                            'alert-error'
                        )
                    }
                })

            // REGISTER FORM HANDLER
            document
                .getElementById('registerForm')
                .addEventListener('submit', function (e) {
                    e.preventDefault()

                    const name = document
                        .getElementById('register-name')
                        .value.trim()
                    const email = document
                        .getElementById('register-email')
                        .value.trim()
                    const password =
                        document.getElementById('register-password').value
                    const confirmPassword = document.getElementById(
                        'register-confirm-password'
                    ).value
                    const agreeTerms =
                        document.getElementById('agree-terms').checked

                    // Clear previous errors
                    hideError('register-name-error')
                    hideError('register-email-error')
                    hideError('register-password-error')
                    hideError('register-confirm-error')

                    // Validation
                    let hasError = false

                    if (name.length < 2) {
                        showError(
                            'register-name-error',
                            'H·ªç t√™n ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±'
                        )
                        hasError = true
                    }

                    if (!isValidEmail(email)) {
                        showError('register-email-error', 'Email kh√¥ng h·ª£p l·ªá')
                        hasError = true
                    }

                    if (password.length < 6) {
                        showError(
                            'register-password-error',
                            'M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±'
                        )
                        hasError = true
                    }

                    if (password !== confirmPassword) {
                        showError(
                            'register-confirm-error',
                            'M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp'
                        )
                        hasError = true
                    }

                    if (!agreeTerms) {
                        showAlert(
                            'register-alert',
                            'B·∫°n c·∫ßn ƒë·ªìng √Ω v·ªõi ƒëi·ªÅu kho·∫£n d·ªãch v·ª•',
                            'alert-error'
                        )
                        hasError = true
                    }

                    if (hasError) return

                    // Get existing users
                    const users = JSON.parse(
                        localStorage.getItem('bs_users') || '[]'
                    )

                    // Check if email already exists
                    if (users.find((u) => u.email === email)) {
                        showAlert(
                            'register-alert',
                            'Email ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω!',
                            'alert-error'
                        )
                        return
                    }

                    // Add new user
                    const newUser = {
                        id: Date.now().toString(),
                        name: name,
                        email: email,
                        password: password,
                        locked: false,
                        createdAt: new Date().toISOString(),
                    }

                    users.push(newUser)
                    localStorage.setItem('bs_users', JSON.stringify(users))

                    showAlert(
                        'register-alert',
                        'ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêang chuy·ªÉn sang ƒëƒÉng nh·∫≠p...',
                        'alert-success'
                    )

                    // Clear form
                    document.getElementById('registerForm').reset()
                    document
                        .getElementById('password-strength')
                        .classList.remove('show')
                    document
                        .getElementById('password-strength-text')
                        .classList.remove('show')

                    setTimeout(() => {
                        switchForm('login')
                        showAlert(
                            'login-alert',
                            'T√†i kho·∫£n ƒë√£ ƒë∆∞·ª£c t·∫°o. Vui l√≤ng ƒëƒÉng nh·∫≠p!',
                            'alert-success'
                        )
                    }, 2000)
                })

            // Check if already logged in
            window.addEventListener('DOMContentLoaded', () => {
                const auth =
                    localStorage.getItem('bs_auth') ||
                    sessionStorage.getItem('bs_auth')
                if (auth) {
                    window.location.href = 'home.html'
                }
            })
        </script>
    </body>
</html>
